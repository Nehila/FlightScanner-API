from flask import Flask, request, jsonify
import requests
from flask_cors import CORS
import json

app = Flask(__name__)
CORS(app)


@app.route('/api/skyscanner', methods=['POST'])
def proxy_request():
    try:
        payload = json.loads(request.get_data(as_text=True))
        print(payload)
        burp0_url = "https://www.skyscanner.fr:443/g/conductor/v1/fps3/search/?geo_schema=skyscanner&carrier_schema=skyscanner&response_include=query%3Bdeeplink%3Bsegment%3Bstats%3Bfqs%3Bpqs"
        burp0_cookies = {"_pxhd": "F1B9TPABTlRytc/ujtDzuwmhYrz33s7iZSSJ/IBa2PMD9NE7ikHTxMy0TTdwZ-wMZgeZ463sLH2SqgJinr63oA==:HN5CJpV6pfXt4LLd7OgZQiSALwBmEZ1SXETVVulOkfODfLwYBsHsFsZlEJffbhEPD0bYBXY0Qmmm03USpiZ3cZjfDghQcMcbKZ5kpWAvv5k=", "traveller_context": "cb1cbce5-3a1a-40c0-ae97-651cf7df1311", "__Secure-anon_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImM3ZGZlYjI2LTlmZjUtNDY4OC1iYjc3LWRiNTY2NWUyNjFkZSJ9.eyJhenAiOiIyNWM3MGZmZDAwN2JkOGQzODM3NyIsImh0dHBzOi8vc2t5c2Nhbm5lci5uZXQvbG9naW5UeXBlIjoiYW5vbnltb3VzIiwiaHR0cHM6Ly9za3lzY2FubmVyLm5ldC91dGlkIjoiY2IxY2JjZTUtM2ExYS00MGMwLWFlOTctNjUxY2Y3ZGYxMzExIiwiaHR0cHM6Ly9za3lzY2FubmVyLm5ldC9jc3JmIjoiM2ZmNWEyNDE4OTA1MGNlMWNlNmQ2M2JiYzk1YWFlOWIiLCJodHRwczovL3NreXNjYW5uZXIubmV0L2p0aSI6ImE2ZmE2ODA4LTg5YzYtNDYxNy1iNTM1LWIyYWRkMzQ1MGE5ZiIsImlhdCI6MTcwOTQwOTk2NCwiZXhwIjoxNzcyNDgxOTY0LCJhdWQiOiJodHRwczovL2dhdGV3YXkuc2t5c2Nhbm5lci5uZXQvaWRlbnRpdHkiLCJpc3MiOiJodHRwczovL3d3dy5za3lzY2FubmVyLm5ldC9zdHRjL2lkZW50aXR5L2p3a3MvcHJvZC8ifQ.dK7nTk5BhRXNY8ANS6pxsMAkWcs8XBv1f596j-Tkixf-D-gyQiko4Gvun7cWf2CN_gB2QAEZUV8ZfeVID2CuX7KuM81R7g7EphT6AFf2dD9pJJnexzaHaCOVPQByURuDo34GbiMziczsL-mU2H89AoMCZg7FlPyc5b7aHRpbQahbcQAtFUVt8WBSuODkgk4zNR_xHaxwERJTewBh0JAAFeNlg01WT_MehtPDbOHFvQ73_-6TMCEHCV0v1N5h1nOT2INXJx5MGGCinfSRfjbYPtXLueJH78l-bBJiRIRc5VOy5viHrORxgvw4vFdsfnKesyvE_wCVsOHlX2Oj9wWHSA", "__Secure-anon_csrf_token": "3ff5a24189050ce1ce6d63bbc95aae9b", "ssculture": "locale:::en-GB&market:::MA&currency:::MAD", "scanner": "currency:::MAD&legs:::RAK|2024-03-03|CMN&tripType:::one-way&rtn:::false&preferDirects:::false&outboundAlts:::false&inboundAlts:::false&from:::RAK&to:::CMN&oym:::2403&oday:::03&wy:::0&cabinclass:::Economy&adults:::3&adultsV2:::3&children:::0&childrenV2&infants:::0", "ssab": "BD_Enable_Hops_for_non_hpa_traffic_V5:::a&BD_Enable_Hops_for_some_market_V11:::a&BD_Save_To_List_Hotels_Enabled_V7:::b&BD_enable_great_price_note_for_hotel_with_cug_V2:::b&Car_Hire_Peak_Desktop_GraphicPromo_V3:::a&Car_Hire_Peak_Desktop_GraphicPromo_IL_AE_V1:::a&EnableSimplifiedGrpcClientWrapper_V3:::b&Gtm_Integration_With_Hotel_Funnel_V4:::a&Guardian_of_the_Galaxy_MAB_PQS_V5:::a&LivePricingPOC_V17:::a&Merch_AirCanada_GP_Desktop_V1:::a&Merch_AirCanada_NDE_Desktop_V1:::b&Multi_city_search_Nav_Card_on_Desktop_V3:::a&PSS_Itinerary_Placement_Desktop_V7:::d&Qatar_Ads_Incremenatility_Experiment_V3:::b&WE_legal_banner_gc_release_V6:::a&ad_performance_migration_weighting_experiment_V8:::a&autosuggest_hotel_popular_recommedation_poc_V3:::b&combined_explore_filter_direct_pill_web_V3:::a&ctr_model_experiment_V5:::b&dmo_brand_incrementality_V0:::a&dummy_jha_2_V0:::c&fps_lus_qrs_use_grpc_client_V5:::a&fps_mr_fqs_flights_ranking_mimir_v2__25i_desktop2_V4:::a&fps_ttlr_early_timeout_banana_V83:::a&fps_ttlr_early_timeout_web_V21:::a&quark_acorn_dsa_inline_products_V6:::b&sam_split_test_014c57ebc3702dc0_V0:::a&sam_split_test_f17089679d72bb6d_V0:::b", "experiment_allocation_id": "ac109fb3f00f4ae602d57bdcf731d5601581d70ecb8d4acb9ab59f772c9963d5", "ssaboverrides": "", "abgroup": "13831721", "__Secure-ska": "99396efe-00ff-4a4c-bbe2-8c1f0c61f1ec", "device_guid": "99396efe-00ff-4a4c-bbe2-8c1f0c61f1ec", "_ga": "GA1.1.99396efe-00ff-4a4c-bbe2-8c1f0c61f1ec.1709409966", "pxcts": "4e0a7d3a-d8d0-11ee-864f-374532c2d912", "_pxvid": "4c9ae0c6-d8d0-11ee-9bbc-f74a0fccb6dc", "_ga_3TVCQ3LJNW": "GS1.1.1709413001.2.1.1709413127.0.0.0", "_px3": "8e60540f7e1c946d3c2b88bd71b441d9061f7ea1620884549470a1af04283afb:TBxiELBv1+tWkUCVumeq71BoNmxfwjzldBYTrjv8fhx4QKvQuaa1wAK12RsFeDF7Kii3RWoMY5bisLvHhO+5xg==:1000:uU7JeJ9VxidSPj96ruaci31bt0cOFo+BbNUvb6ycMMdBg03oKiD7xlVVjjglzo6rYYNYULiec0QdgOvjRhltPKQ9ay6EVEubvzZvQ6TffKXJOly2MO6y4ZHKr3fWpIqySjf+EhtUysJLa1lgmb+nue2q0Mo9/j7P94d42RTXhY0BMi6+8lBV39x/4EHd50mro/InQBlpPPc7wAIDXqiWe+Da/7yDYFFv9o9EjNkh5kM=", "cto_bundle": "S0dRf19hdnh0cUJDeGpxb2pkUU1yZ2NrdnZHeFMzYiUyQkU2QVh5RTBRMlRHVmtqS013WUolMkJnUDluS2JPckQwa2NKTkRyV1RmaWNXOUZzSXc2NUFDaWxrWFBaQzNyRjkza0g5Y2hFNzlmVzFpYTg2R3BSd0ZIaDRUQW4lMkZrJTJGZXVNdnBDdHFyTSUyQnhFVndNaHp0OWZIM25lQ0JPMzdnJTNEJTNE", "QSI_S_ZN_0VDsL2Wl8ZAlxlA": "r:2:2", "preferences": "cb1cbce53a1a40c0ae97651cf7df1311", "_gid": "GA1.2.1508770352.1709413003", "__gsas": "ID=8c580836a95b2423:T=1709413026:RT=1709413026:S=ALNI_MZOGxIkm8obYV7g7Hx40PvzXArQ1Q", "__gads": "ID=3badbc0377bcff74:T=1709413028:RT=1709413028:S=ALNI_Mbnz0gS8k7lTgDeYE_urqGRqPS-bA", "__gpi": "UID=00000d3ac19562a1:T=1709413028:RT=1709413028:S=ALNI_MacPT6LxUz54qyUxiN9fBPD9E9FGw", "__eoi": "ID=8f94f7a4c3da3eda:T=1709413028:RT=1709413028:S=AA-Afja0ghf-abk3Gh3EJXt4C_7_", "_fbp": "fb.1.1709413032613.1478178712", "_clck": "2h4opa%7C2%7Cfjq%7C0%7C1522", "_clsk": "ihkpn1%7C1709413065656%7C2%7C0%7Cr.clarity.ms%2Fcollect", "_uetsid": "711097d0d8d711ee9fc0c1bb33ed75e6", "_uetvid": "711086d0d8d711ee8226b548e83396d6", "_gat": "1", "avoid_banana_results": "true"}
        burp0_headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0", "Accept": "application/json", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate, br", "Referer": "https://www.skyscanner.fr/transport/flights/rak/cmn/240303/?adultsv2=3&cabinclass=economy&childrenv2=&currency=MAD&inboundaltsenabled=false&outboundaltsenabled=false&preferdirects=false&ref=home&rtn=0", "X-Skyscanner-Channelid": "website", "X-Skyscanner-Devicedetection-Ismobile": "false", "X-Skyscanner-Devicedetection-Istablet": "false", "X-Skyscanner-Traveller-Context": "cb1cbce5-3a1a-40c0-ae97-651cf7df1311", "X-Skyscanner-Utid": "cb1cbce5-3a1a-40c0-ae97-651cf7df1311", "X-Skyscanner-Viewid": "bd038939-41b7-40b2-97af-203df4656dba", "Content-Type": "application/json", "Origin": "https://www.skyscanner.fr", "Sec-Fetch-Dest": "empty", "Sec-Fetch-Mode": "cors", "Sec-Fetch-Site": "same-origin", "Te": "trailers"}
        response = requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, json=payload)

        return response.json()

    except Exception as e:
        return jsonify({'error': str(e)}), 500
    

@app.route('/api/session/<session_id>', methods=['POST'])
def proxy_request_two(session_id):
    try:
        payload = json.loads(request.get_data(as_text=True))
        print(payload)
        burp0_url = f"https://www.skyscanner.fr:443/g/conductor/v1/fps3/search/{session_id}?geo_schema=skyscanner&carrier_schema=skyscanner&response_include=query%3Bdeeplink%3Bsegment%3Bstats%3Bfqs%3Bpqs"
        burp0_cookies = {"_pxhd": "F1B9TPABTlRytc/ujtDzuwmhYrz33s7iZSSJ/IBa2PMD9NE7ikHTxMy0TTdwZ-wMZgeZ463sLH2SqgJinr63oA==:HN5CJpV6pfXt4LLd7OgZQiSALwBmEZ1SXETVVulOkfODfLwYBsHsFsZlEJffbhEPD0bYBXY0Qmmm03USpiZ3cZjfDghQcMcbKZ5kpWAvv5k=", "traveller_context": "cb1cbce5-3a1a-40c0-ae97-651cf7df1311", "__Secure-anon_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImM3ZGZlYjI2LTlmZjUtNDY4OC1iYjc3LWRiNTY2NWUyNjFkZSJ9.eyJhenAiOiIyNWM3MGZmZDAwN2JkOGQzODM3NyIsImh0dHBzOi8vc2t5c2Nhbm5lci5uZXQvbG9naW5UeXBlIjoiYW5vbnltb3VzIiwiaHR0cHM6Ly9za3lzY2FubmVyLm5ldC91dGlkIjoiY2IxY2JjZTUtM2ExYS00MGMwLWFlOTctNjUxY2Y3ZGYxMzExIiwiaHR0cHM6Ly9za3lzY2FubmVyLm5ldC9jc3JmIjoiM2ZmNWEyNDE4OTA1MGNlMWNlNmQ2M2JiYzk1YWFlOWIiLCJodHRwczovL3NreXNjYW5uZXIubmV0L2p0aSI6ImE2ZmE2ODA4LTg5YzYtNDYxNy1iNTM1LWIyYWRkMzQ1MGE5ZiIsImlhdCI6MTcwOTQwOTk2NCwiZXhwIjoxNzcyNDgxOTY0LCJhdWQiOiJodHRwczovL2dhdGV3YXkuc2t5c2Nhbm5lci5uZXQvaWRlbnRpdHkiLCJpc3MiOiJodHRwczovL3d3dy5za3lzY2FubmVyLm5ldC9zdHRjL2lkZW50aXR5L2p3a3MvcHJvZC8ifQ.dK7nTk5BhRXNY8ANS6pxsMAkWcs8XBv1f596j-Tkixf-D-gyQiko4Gvun7cWf2CN_gB2QAEZUV8ZfeVID2CuX7KuM81R7g7EphT6AFf2dD9pJJnexzaHaCOVPQByURuDo34GbiMziczsL-mU2H89AoMCZg7FlPyc5b7aHRpbQahbcQAtFUVt8WBSuODkgk4zNR_xHaxwERJTewBh0JAAFeNlg01WT_MehtPDbOHFvQ73_-6TMCEHCV0v1N5h1nOT2INXJx5MGGCinfSRfjbYPtXLueJH78l-bBJiRIRc5VOy5viHrORxgvw4vFdsfnKesyvE_wCVsOHlX2Oj9wWHSA", "__Secure-anon_csrf_token": "3ff5a24189050ce1ce6d63bbc95aae9b", "ssculture": "locale:::en-GB&market:::MA&currency:::MAD", "scanner": "currency:::MAD&legs:::RAK|2024-03-03|CMN&tripType:::one-way&rtn:::false&preferDirects:::false&outboundAlts:::false&inboundAlts:::false&from:::RAK&to:::CMN&oym:::2403&oday:::03&wy:::0&cabinclass:::Economy&adults:::3&adultsV2:::3&children:::0&childrenV2&infants:::0", "ssab": "BD_Enable_Hops_for_non_hpa_traffic_V5:::a&BD_Enable_Hops_for_some_market_V11:::a&BD_Save_To_List_Hotels_Enabled_V7:::b&BD_enable_great_price_note_for_hotel_with_cug_V2:::b&Car_Hire_Peak_Desktop_GraphicPromo_V3:::a&Car_Hire_Peak_Desktop_GraphicPromo_IL_AE_V1:::a&EnableSimplifiedGrpcClientWrapper_V3:::b&Gtm_Integration_With_Hotel_Funnel_V4:::a&Guardian_of_the_Galaxy_MAB_PQS_V5:::a&LivePricingPOC_V17:::a&Merch_AirCanada_GP_Desktop_V1:::a&Merch_AirCanada_NDE_Desktop_V1:::b&Multi_city_search_Nav_Card_on_Desktop_V3:::a&PSS_Itinerary_Placement_Desktop_V7:::d&Qatar_Ads_Incremenatility_Experiment_V3:::b&WE_legal_banner_gc_release_V6:::a&ad_performance_migration_weighting_experiment_V8:::a&autosuggest_hotel_popular_recommedation_poc_V3:::b&combined_explore_filter_direct_pill_web_V3:::a&ctr_model_experiment_V5:::b&dmo_brand_incrementality_V0:::a&dummy_jha_2_V0:::c&fps_lus_qrs_use_grpc_client_V5:::a&fps_mr_fqs_flights_ranking_mimir_v2__25i_desktop2_V4:::a&fps_ttlr_early_timeout_banana_V83:::a&fps_ttlr_early_timeout_web_V21:::a&quark_acorn_dsa_inline_products_V6:::b&sam_split_test_014c57ebc3702dc0_V0:::a&sam_split_test_f17089679d72bb6d_V0:::b", "experiment_allocation_id": "ac109fb3f00f4ae602d57bdcf731d5601581d70ecb8d4acb9ab59f772c9963d5", "ssaboverrides": "", "abgroup": "13831721", "__Secure-ska": "99396efe-00ff-4a4c-bbe2-8c1f0c61f1ec", "device_guid": "99396efe-00ff-4a4c-bbe2-8c1f0c61f1ec", "_ga": "GA1.1.99396efe-00ff-4a4c-bbe2-8c1f0c61f1ec.1709409966", "pxcts": "4e0a7d3a-d8d0-11ee-864f-374532c2d912", "_pxvid": "4c9ae0c6-d8d0-11ee-9bbc-f74a0fccb6dc", "_ga_3TVCQ3LJNW": "GS1.1.1709413001.2.1.1709413127.0.0.0", "_px3": "8e60540f7e1c946d3c2b88bd71b441d9061f7ea1620884549470a1af04283afb:TBxiELBv1+tWkUCVumeq71BoNmxfwjzldBYTrjv8fhx4QKvQuaa1wAK12RsFeDF7Kii3RWoMY5bisLvHhO+5xg==:1000:uU7JeJ9VxidSPj96ruaci31bt0cOFo+BbNUvb6ycMMdBg03oKiD7xlVVjjglzo6rYYNYULiec0QdgOvjRhltPKQ9ay6EVEubvzZvQ6TffKXJOly2MO6y4ZHKr3fWpIqySjf+EhtUysJLa1lgmb+nue2q0Mo9/j7P94d42RTXhY0BMi6+8lBV39x/4EHd50mro/InQBlpPPc7wAIDXqiWe+Da/7yDYFFv9o9EjNkh5kM=", "cto_bundle": "S0dRf19hdnh0cUJDeGpxb2pkUU1yZ2NrdnZHeFMzYiUyQkU2QVh5RTBRMlRHVmtqS013WUolMkJnUDluS2JPckQwa2NKTkRyV1RmaWNXOUZzSXc2NUFDaWxrWFBaQzNyRjkza0g5Y2hFNzlmVzFpYTg2R3BSd0ZIaDRUQW4lMkZrJTJGZXVNdnBDdHFyTSUyQnhFVndNaHp0OWZIM25lQ0JPMzdnJTNEJTNE", "QSI_S_ZN_0VDsL2Wl8ZAlxlA": "r:2:2", "preferences": "cb1cbce53a1a40c0ae97651cf7df1311", "_gid": "GA1.2.1508770352.1709413003", "__gsas": "ID=8c580836a95b2423:T=1709413026:RT=1709413026:S=ALNI_MZOGxIkm8obYV7g7Hx40PvzXArQ1Q", "__gads": "ID=3badbc0377bcff74:T=1709413028:RT=1709413028:S=ALNI_Mbnz0gS8k7lTgDeYE_urqGRqPS-bA", "__gpi": "UID=00000d3ac19562a1:T=1709413028:RT=1709413028:S=ALNI_MacPT6LxUz54qyUxiN9fBPD9E9FGw", "__eoi": "ID=8f94f7a4c3da3eda:T=1709413028:RT=1709413028:S=AA-Afja0ghf-abk3Gh3EJXt4C_7_", "_fbp": "fb.1.1709413032613.1478178712", "_clck": "2h4opa%7C2%7Cfjq%7C0%7C1522", "_clsk": "ihkpn1%7C1709413065656%7C2%7C0%7Cr.clarity.ms%2Fcollect", "_uetsid": "711097d0d8d711ee9fc0c1bb33ed75e6", "_uetvid": "711086d0d8d711ee8226b548e83396d6", "_gat": "1", "avoid_banana_results": "true"}
        burp0_headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0", "Accept": "application/json", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate, br", "Referer": "https://www.skyscanner.fr/transport/flights/rak/cmn/240303/?adultsv2=3&cabinclass=economy&childrenv2=&currency=MAD&inboundaltsenabled=false&outboundaltsenabled=false&preferdirects=false&ref=home&rtn=0", "X-Skyscanner-Channelid": "website", "X-Skyscanner-Devicedetection-Ismobile": "false", "X-Skyscanner-Devicedetection-Istablet": "false", "X-Skyscanner-Traveller-Context": "cb1cbce5-3a1a-40c0-ae97-651cf7df1311", "X-Skyscanner-Utid": "cb1cbce5-3a1a-40c0-ae97-651cf7df1311", "X-Skyscanner-Viewid": "bd038939-41b7-40b2-97af-203df4656dba", "Content-Type": "application/json", "Origin": "https://www.skyscanner.fr", "Sec-Fetch-Dest": "empty", "Sec-Fetch-Mode": "cors", "Sec-Fetch-Site": "same-origin", "Te": "trailers"}
        response = requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies)

        return response.json()

    except Exception as e:
        return jsonify({'error': str(e)}), 500

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0')
